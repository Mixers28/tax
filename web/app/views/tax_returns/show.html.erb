<div class="container">
  <div class="tax-return-detail">
    <div class="header">
      <div class="back-link">
        <%= link_to "‚Üê Back to Tax Returns", tax_returns_path %>
      </div>
      <h1><%= @tax_return.tax_year.label %></h1>
      <p class="status-badge">
        Status: <span class="status status-<%= @tax_return.status %>"><%= @tax_return.status.titleize %></span>
      </p>
    </div>

    <div class="content">
      <div class="tabs">
        <a href="#overview" class="tab-button active" data-tab="overview">Overview</a>
        <a href="#income" class="tab-button" data-tab="income">Income</a>
        <a href="#reliefs" class="tab-button" data-tab="reliefs">Tax Reliefs</a>
        <a href="#evidence" class="tab-button" data-tab="evidence">Evidence</a>
        <a href="#validations" class="tab-button" data-tab="validations">Validations</a>
        <a href="#exports" class="tab-button" data-tab="exports">Exports</a>
        <a href="#settings" class="tab-button" data-tab="settings">Settings</a>
      </div>

      <div id="overview" class="tab-content active">
        <div class="section">
          <h2>Tax Return Details</h2>
          <div class="details-grid">
            <div class="detail-item">
              <label>Tax Year</label>
              <p><%= @tax_return.tax_year.label %></p>
            </div>
            <div class="detail-item">
              <label>Status</label>
              <p><span class="status status-<%= @tax_return.status %>"><%= @tax_return.status.titleize %></span></p>
            </div>
            <div class="detail-item">
              <label>Created</label>
              <p><%= @tax_return.created_at.strftime("%d %b %Y at %H:%M") %></p>
            </div>
            <div class="detail-item">
              <label>Box Values</label>
              <p><%= @tax_return.box_values.count %> entered</p>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Quick Actions</h2>
          <div class="actions">
            <%= link_to "Upload Evidence", new_evidence_path(tax_return_id: @tax_return.id), class: "btn btn-primary" %>
            <%= link_to "Run Validations", tax_return_validations_path(@tax_return), class: "btn btn-secondary" %>
            <%= link_to "Review & Export", "/tax_returns/#{@tax_return.id}/exports/review", class: "btn btn-primary" %>
          </div>
        </div>
      </div>

      <div id="income" class="tab-content">
        <div class="section">
          <h2>üí∑ Income Sources</h2>

          <% if @tax_return.income_sources.any? %>
            <div class="income-summary-cards">
              <div class="summary-card">
                <label>Total Gross Income</label>
                <p class="value">¬£<%= number_with_precision(@tax_return.income_sources.sum(:amount_gross), precision: 2) %></p>
              </div>
              <div class="summary-card">
                <label>Total Tax Taken</label>
                <p class="value">¬£<%= number_with_precision(@tax_return.income_sources.sum(:amount_tax_taken), precision: 2) %></p>
              </div>
              <div class="summary-card">
                <label>Number of Sources</label>
                <p class="value"><%= @tax_return.income_sources.count %></p>
              </div>
            </div>

            <div class="income-list-section">
              <h3>Income Breakdown</h3>
              <div class="income-items">
                <% @tax_return.income_sources.each do |source| %>
                  <div class="income-item">
                    <div class="income-type">
                      <span class="badge"><%= source.source_type.titleize %></span>
                    </div>
                    <div class="income-details">
                      <p class="description"><%= source.description.present? ? source.description : "No description" %></p>
                      <p class="amounts">
                        Gross: <strong>¬£<%= number_with_precision(source.amount_gross, precision: 2) %></strong> &nbsp; | &nbsp;
                        Tax: <strong>¬£<%= number_with_precision(source.amount_tax_taken, precision: 2) %></strong>
                      </p>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% else %>
            <div class="empty-section">
              <p class="empty-message">No income sources added yet</p>
              <p class="text-muted">Add your income sources to calculate tax liability</p>
            </div>
          <% end %>

          <div class="section-actions">
            <%= link_to "Manage Income Sources", tax_return_income_sources_path(@tax_return), class: "btn btn-primary" %>
          </div>
        </div>
      </div>

      <div id="reliefs" class="tab-content">
        <div class="section">
          <h2>üèõÔ∏è Tax Reliefs</h2>
          <p class="section-description">Manage your tax reliefs to reduce your tax liability and increase your tax-free personal allowance.</p>

          <div class="relief-categories">
            <!-- Blind Person's Allowance -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>Blind Person's Allowance</h3>
                <p class="relief-amount">¬£3,070</p>
              </div>
              <p class="relief-description">Additional allowance added to your personal allowance if you're registered blind.</p>
              <div class="relief-status">
                <% if @tax_return.is_blind_person %>
                  <span class="status-badge status-active">‚úì Enabled</span>
                <% else %>
                  <span class="status-badge status-inactive">‚úó Not claimed</span>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= form_with url: toggle_blind_person_tax_return_path(@tax_return), method: :patch, local: true, style: "display: inline;" do %>
                  <% if @tax_return.is_blind_person %>
                    <%= submit_tag "Disable Blind Allowance", class: "btn btn-secondary btn-sm" %>
                  <% else %>
                    <%= submit_tag "Enable Blind Allowance", class: "btn btn-primary btn-sm" %>
                  <% end %>
                <% end %>
              </div>
            </div>

            <!-- Pension Contributions -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>Pension Contributions</h3>
                <p class="relief-amount">
                  <% contributions = @tax_return.income_sources.pension_contributions.sum(:amount_gross).to_f %>
                  ¬£<%= number_with_precision(contributions / 0.8, precision: 2) %>
                </p>
              </div>
              <p class="relief-description">Basic rate tax relief on personal pension contributions (25% added by HMRC).</p>
              <div class="relief-items">
                <% contributions = @tax_return.income_sources.pension_contributions %>
                <% if contributions.any? %>
                  <div class="items-list">
                    <% contributions.each do |contribution| %>
                      <div class="item-row">
                        <span class="item-label"><%= contribution.description.presence || "Pension" %></span>
                        <span class="item-value">¬£<%= number_with_precision(contribution.amount_gross / 0.8, precision: 2) %></span>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <p class="relief-empty">No pension contributions added yet</p>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= link_to "Manage Contributions", tax_return_pension_contributions_path(@tax_return), class: "btn btn-primary btn-sm" %>
              </div>
            </div>

            <!-- Gift Aid Donations -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>Gift Aid Donations</h3>
                <p class="relief-amount">
                  <% donations = @tax_return.income_sources.gift_aid_donations.sum(:amount_gross).to_f %>
                  ¬£<%= number_with_precision(donations / 0.8, precision: 2) %>
                </p>
              </div>
              <p class="relief-description">Tax relief on charitable donations. Extends your basic rate band for higher/additional rate taxpayers.</p>
              <div class="relief-items">
                <% donations = @tax_return.income_sources.gift_aid_donations %>
                <% if donations.any? %>
                  <div class="items-list">
                    <% donations.each do |donation| %>
                      <div class="item-row">
                        <span class="item-label"><%= donation.description.presence || "Donation" %></span>
                        <span class="item-value">¬£<%= number_with_precision(donation.amount_gross / 0.8, precision: 2) %></span>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <p class="relief-empty">No Gift Aid donations added yet</p>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= link_to "Manage Donations", tax_return_gift_aid_donations_path(@tax_return), class: "btn btn-primary btn-sm" %>
              </div>
            </div>

            <!-- Trading Allowance (Phase 5d) -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>üìä Trading Allowance</h3>
                <p class="relief-amount"><%= @tax_return.uses_trading_allowance ? "¬£1,000" : "‚Äî" %></p>
              </div>
              <p class="relief-description">¬£1,000 simplified expenses deduction for self-employed or miscellaneous trading income. Useful if your actual expenses are less than ¬£1,000.</p>
              <div class="relief-status">
                <% if @tax_return.uses_trading_allowance %>
                  <span class="status-badge status-active">‚úì Enabled</span>
                <% else %>
                  <span class="status-badge status-inactive">‚úó Not claimed</span>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= form_with url: toggle_trading_allowance_tax_return_path(@tax_return), method: :patch, local: true, style: "display: inline;" do %>
                  <% if @tax_return.uses_trading_allowance %>
                    <%= submit_tag "Disable Trading Allowance", class: "btn btn-secondary btn-sm" %>
                  <% else %>
                    <%= submit_tag "Enable Trading Allowance", class: "btn btn-primary btn-sm" %>
                  <% end %>
                <% end %>
              </div>
            </div>

            <!-- Marriage Allowance (Phase 5d) -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>üíë Marriage Allowance</h3>
                <p class="relief-amount"><%= @tax_return.claims_marriage_allowance ? "¬£1,260" : "‚Äî" %></p>
              </div>
              <p class="relief-description">Transfer 10% of your Personal Allowance (¬£1,260) to your spouse if you don't use your full allowance. Tax saving: ¬£252 for your spouse.</p>
              <div class="relief-status">
                <% if @tax_return.claims_marriage_allowance %>
                  <span class="status-badge status-active">‚úì Claimed (<%= @tax_return.marriage_allowance_role&.titleize %>) </span>
                <% else %>
                  <span class="status-badge status-inactive">‚úó Not claimed</span>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= form_with model: @tax_return, url: update_marriage_allowance_tax_return_path(@tax_return), method: :patch, local: true do |f| %>
                  <div class="relief-form-row">
                    <div class="relief-checkbox">
                      <%= f.check_box :claims_marriage_allowance, { id: "marriage_allowance_toggle" }, "true", "false" %>
                      <%= f.label :claims_marriage_allowance, "Claim Marriage Allowance", class: "relief-checkbox-label" %>
                    </div>
                    <div id="marriage_allowance_role" class="relief-fields" style="<%= 'display:none;' unless @tax_return.claims_marriage_allowance %>">
                      <%= f.label :marriage_allowance_role, "I am the:", class: "relief-field-label" %>
                      <%= f.select :marriage_allowance_role, [['Transferor (giving allowance)', 'transferor'], ['Transferee (receiving allowance)', 'transferee']], { include_blank: 'Select your role' }, class: "relief-select" %>
                    </div>
                  </div>
                  <%= f.submit "Save", class: "btn btn-primary btn-sm", style: "margin-top: 0.5rem;" %>
                <% end %>
              </div>
            </div>

            <!-- Married Couple's Allowance (Phase 5d) -->
            <div class="relief-card">
              <div class="relief-header">
                <h3>üë´ Married Couple's Allowance</h3>
                <p class="relief-amount">Up to ¬£1,108</p>
              </div>
              <p class="relief-description">10% tax relief on up to ¬£11,080 of allowance. Available if one spouse was born before 6 April 1935 (age 90+) and you're not claiming Marriage Allowance.</p>
              <div class="relief-status">
                <% if @tax_return.claims_married_couples_allowance %>
                  <span class="status-badge status-active">‚úì Enabled</span>
                <% else %>
                  <span class="status-badge status-inactive">‚úó Not claimed</span>
                <% end %>
              </div>
              <div class="relief-actions">
                <%= form_with model: @tax_return, url: update_married_couples_allowance_tax_return_path(@tax_return), method: :patch, local: true do |f| %>
                  <div class="relief-form-row">
                    <div class="relief-checkbox">
                      <%= f.check_box :claims_married_couples_allowance, { id: "mca_toggle" }, "true", "false" %>
                      <%= f.label :claims_married_couples_allowance, "Claim Married Couple's Allowance", class: "relief-checkbox-label" %>
                    </div>
                    <div id="mca_details" class="relief-fields" style="<%= 'display:none;' unless @tax_return.claims_married_couples_allowance %>">
                      <%= f.label :spouse_dob, "Spouse date of birth:", class: "relief-field-label" %>
                      <%= f.date_field :spouse_dob, class: "relief-date-input", placeholder: "dd/mm/yyyy" %>
                      <p class="relief-field-hint">Used to verify age eligibility (born before 6 April 1935)</p>
                    </div>
                  </div>
                  <%= f.submit "Save", class: "btn btn-primary btn-sm", style: "margin-top: 0.5rem;" %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="evidence" class="tab-content">
        <div class="section">
          <h2>Evidence Files</h2>
          <% blank_forms = @tax_return.evidences.where(evidence_type: "blank_form") %>
          <% supporting_docs = @tax_return.evidences.where(evidence_type: "supporting_document") %>

          <% if @tax_return.evidences.any? %>
            <% if blank_forms.any? %>
              <div class="evidence-category">
                <h3>üìÑ Blank Tax Forms (<%= blank_forms.count %>)</h3>
                <div class="evidence-list">
                  <% blank_forms.each do |evidence| %>
                    <div class="evidence-item">
                      <div class="evidence-info">
                        <p><strong><%= evidence.filename || "Blank Form" %></strong></p>
                        <p class="text-muted">Uploaded: <%= evidence.created_at.strftime("%d %b %Y") %></p>
                      </div>
                      <div class="evidence-actions">
                        <%= link_to "View", evidence_path(evidence), class: "link-btn" %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>

            <% if supporting_docs.any? %>
              <div class="evidence-category">
                <h3>üìé Supporting Documents (<%= supporting_docs.count %>)</h3>
                <div class="evidence-list">
                  <% supporting_docs.each do |evidence| %>
                    <div class="evidence-item">
                      <div class="evidence-info">
                        <p><strong><%= evidence.filename || "Supporting Document" %></strong></p>
                        <p class="text-muted">Uploaded: <%= evidence.created_at.strftime("%d %b %Y") %></p>
                      </div>
                      <div class="evidence-actions">
                        <%= link_to "View", evidence_path(evidence), class: "link-btn" %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% else %>
            <p class="empty-message">No evidence files uploaded yet</p>
          <% end %>
          <%= link_to "Upload More Evidence", new_evidence_path(tax_return_id: @tax_return.id), class: "btn btn-primary" %>
        </div>
      </div>

      <div id="validations" class="tab-content">
        <div class="section">
          <h2>Validations</h2>
          <p><%= link_to "Run Validations", tax_return_validations_path(@tax_return), class: "btn btn-primary" %></p>
        </div>
      </div>

      <div id="exports" class="tab-content">
        <div class="section">
          <h2>Exports</h2>
          <p><%= link_to "Review & Generate New Export", "/tax_returns/#{@tax_return.id}/exports/review", class: "btn btn-primary" %></p>

          <% if @tax_return.exports.any? %>
            <div class="exports-list">
              <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Previous Exports</h3>
              <% @tax_return.exports.each do |export| %>
                <div class="export-item">
                  <p><strong>Export #<%= export.id %></strong></p>
                  <p class="text-muted">Generated: <%= export.exported_at.strftime("%d %b %Y at %H:%M") %></p>
                  <div class="export-actions">
                    <% if export.file_path.present? %>
                      <%= link_to "PDF", download_pdf_tax_return_export_path(@tax_return, export), class: "link-btn" %>
                    <% end %>
                    <% if export.json_path.present? %>
                      <%= link_to "JSON", download_json_tax_return_export_path(@tax_return, export), class: "link-btn" %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="empty-message">No exports yet. Start by reviewing your data and generating an export.</p>
          <% end %>
        </div>
      </div>

      <div id="settings" class="tab-content">
        <div class="section">
          <h2>Calculator Settings</h2>
          <p class="settings-description">Select which tax calculations are relevant to your tax return.</p>

          <%= form_with url: update_calculator_settings_tax_return_path(@tax_return), method: :patch, local: true do |f| %>
            <div class="calculators-grid">
              <% TaxReturn::AVAILABLE_CALCULATORS.each do |code, label| %>
                <div class="calculator-card">
                  <div class="calculator-header">
                    <input
                      type="checkbox"
                      name="calculators[]"
                      value="<%= code %>"
                      id="calculator_<%= code %>"
                      <%= 'checked' if @tax_return.calculator_enabled?(code) %>
                      class="calculator-checkbox"
                    />
                    <label for="calculator_<%= code %>" class="calculator-label"><%= label %></label>
                  </div>
                  <div class="calculator-description">
                    <% description_map = {
                      ftcr: "Relief for furnished holiday accommodation. Only if you rent out furnished holiday properties.",
                      gift_aid: "Tax relief on charitable donations. Enable if you made charitable contributions.",
                      hicbc: "High Income Child Benefit Charge. Only applies if you have income over ¬£50,000."
                    } %>
                    <p><%= description_map[code] %></p>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="settings-actions">
              <%= f.submit "Save Settings", class: "btn btn-primary" %>
              <%= link_to "Cancel", tax_return_path(@tax_return), class: "btn btn-secondary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .container {
    background-color: #f5f7fa;
    min-height: 100vh;
    padding: 1rem;
  }

  .tax-return-detail {
    max-width: 1000px;
    margin: 0 auto;
  }

  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
  }

  .back-link {
    margin-bottom: 1rem;
  }

  .back-link a {
    color: white;
    text-decoration: none;
    opacity: 0.9;
  }

  .back-link a:hover {
    opacity: 1;
    text-decoration: underline;
  }

  .header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .status-badge {
    font-size: 0.95rem;
  }

  .content {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .tabs {
    display: flex;
    border-bottom: 2px solid #eee;
    background-color: #f8f9fa;
  }

  .tab-button {
    flex: 1;
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    background: none;
    border: none;
    font-size: 0.95rem;
    color: #666;
    text-decoration: none;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
  }

  .tab-button:hover {
    background-color: white;
    color: #667eea;
  }

  .tab-button.active {
    color: #667eea;
    border-bottom-color: #667eea;
    background-color: white;
  }

  .tab-content {
    display: none;
    padding: 2rem;
  }

  .tab-content.active {
    display: block;
  }

  .section {
    margin-bottom: 2rem;
  }

  .section:last-child {
    margin-bottom: 0;
  }

  .section h2 {
    font-size: 1.3rem;
    margin-bottom: 1.5rem;
    color: #333;
  }

  .details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .detail-item {
    padding: 1rem;
    background-color: #f8f9fa;
    border-radius: 4px;
  }

  .detail-item label {
    display: block;
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .detail-item p {
    font-size: 0.95rem;
    color: #333;
  }

  .status {
    display: inline-block;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .status-draft {
    background-color: #ffeaa7;
    color: #d63031;
  }

  .actions {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s;
  }

  .btn-primary {
    background-color: #667eea;
    color: white;
  }

  .btn-primary:hover {
    background-color: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }

  .btn-secondary {
    background-color: #e9ecef;
    color: #333;
  }

  .btn-secondary:hover {
    background-color: #dee2e6;
  }

  .evidence-category {
    margin-bottom: 2rem;
  }

  .evidence-category h3 {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #dee2e6;
  }

  .evidence-list,
  .exports-list {
    border: 1px solid #eee;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .evidence-item,
  .export-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #eee;
  }

  .evidence-item:last-child,
  .export-item:last-child {
    border-bottom: none;
  }

  .evidence-info,
  .export-info {
    flex: 1;
  }

  .evidence-info p,
  .export-info p {
    margin: 0.25rem 0;
  }

  .text-muted {
    font-size: 0.85rem;
    color: #999;
  }

  .evidence-actions,
  .export-actions {
    display: flex;
    gap: 0.5rem;
  }

  .link-btn {
    padding: 0.5rem 1rem;
    background-color: #667eea;
    color: white;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.9rem;
    transition: background-color 0.3s;
  }

  .link-btn:hover {
    background-color: #5568d3;
  }

  .empty-message {
    color: #999;
    font-style: italic;
    margin-bottom: 1rem;
  }

  .settings-description {
    color: #666;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
  }

  .calculators-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .calculator-card {
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 1.5rem;
    background-color: #fafbfc;
    transition: all 0.3s;
  }

  .calculator-card:hover {
    border-color: #667eea;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
  }

  .calculator-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .calculator-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: #667eea;
  }

  .calculator-label {
    font-weight: 600;
    color: #333;
    cursor: pointer;
    flex: 1;
  }

  .calculator-description {
    margin-left: 2.5rem;
    padding-left: 0;
  }

  .calculator-description p {
    font-size: 0.85rem;
    color: #666;
    line-height: 1.4;
    margin: 0;
  }

  .settings-actions {
    display: flex;
    gap: 1rem;
  }

  .section-description {
    color: #666;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
  }

  .relief-categories {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .relief-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 1.5rem;
    background-color: #fafbfc;
    transition: all 0.3s;
  }

  .relief-card:hover {
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
  }

  .relief-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
  }

  .relief-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #333;
  }

  .relief-amount {
    font-size: 1.3rem;
    font-weight: bold;
    color: #667eea;
    margin: 0;
  }

  .relief-description {
    color: #666;
    font-size: 0.9rem;
    margin: 0 0 1rem 0;
    line-height: 1.4;
  }

  .relief-status {
    margin-bottom: 1rem;
  }

  .status-badge {
    display: inline-block;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .status-active {
    background-color: #d4edda;
    color: #155724;
  }

  .status-inactive {
    background-color: #f8d7da;
    color: #721c24;
  }

  .relief-items {
    margin-bottom: 1rem;
  }

  .items-list {
    background-color: white;
    border: 1px solid #eee;
    border-radius: 4px;
    overflow: hidden;
  }

  .item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #eee;
  }

  .item-row:last-child {
    border-bottom: none;
  }

  .item-label {
    color: #333;
    font-size: 0.9rem;
  }

  .item-value {
    color: #667eea;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .relief-empty {
    color: #999;
    font-style: italic;
    font-size: 0.9rem;
    margin: 0;
    padding: 0.75rem;
  }

  .relief-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
  }

  .relief-form-row {
    margin-bottom: 1rem;
  }

  .relief-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .relief-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #667eea;
  }

  .relief-checkbox-label {
    cursor: pointer;
    font-weight: 500;
    color: #333;
    margin: 0;
  }

  .relief-fields {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 1rem;
    margin-top: 0.75rem;
  }

  .relief-field-label {
    display: block;
    font-weight: 500;
    color: #333;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .relief-select,
  .relief-date-input {
    width: 100%;
    padding: 0.6rem 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9rem;
    color: #333;
    background-color: white;
    margin-bottom: 0.5rem;
  }

  .relief-select:focus,
  .relief-date-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .relief-field-hint {
    font-size: 0.8rem;
    color: #999;
    margin: 0.5rem 0 0 0;
    font-style: italic;
  }

  @media (max-width: 768px) {
    .tabs {
      flex-wrap: wrap;
    }

    .tab-button {
      flex: 1 0 50%;
    }

    .evidence-item,
    .export-item {
      flex-direction: column;
      align-items: flex-start;
    }

    .evidence-actions,
    .export-actions {
      margin-top: 1rem;
      width: 100%;
    }

    .calculators-grid {
      grid-template-columns: 1fr;
    }

    .settings-actions {
      flex-direction: column;
    }

    .settings-actions .btn {
      width: 100%;
      text-align: center;
    }
  }
</style>

<script>
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const tabId = this.getAttribute('data-tab');

      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });

      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });

      // Show selected tab
      document.getElementById(tabId).classList.add('active');
      this.classList.add('active');
    });
  });

  // Phase 5d Relief Toggle Handlers

  // Marriage Allowance toggle
  const marriageAllowanceToggle = document.getElementById('marriage_allowance_toggle');
  const marriageAllowanceRole = document.getElementById('marriage_allowance_role');

  if (marriageAllowanceToggle) {
    marriageAllowanceToggle.addEventListener('change', function() {
      if (marriageAllowanceRole) {
        marriageAllowanceRole.style.display = this.checked ? 'block' : 'none';
      }
    });
  }

  // Married Couple's Allowance toggle
  const mcaToggle = document.getElementById('mca_toggle');
  const mcaDetails = document.getElementById('mca_details');

  if (mcaToggle) {
    mcaToggle.addEventListener('change', function() {
      if (mcaDetails) {
        mcaDetails.style.display = this.checked ? 'block' : 'none';
      }
    });
  }
</script>
